CREATE TABLESPACE "CBFILES" LOGGING 
DATAFILE 'D:\ORACLE\ORADATA\CITYBILL\CBFILES.DBF' SIZE 1024M 
AUTOEXTEND ON 
NEXT 128M
MAXSIZE  4096M
EXTENT MANAGEMENT LOCAL SEGMENT SPACE MANAGEMENT  AUTO
ONLINE;

CREATE TABLESPACE "CB2001" LOGGING 
DATAFILE 'D:\ORACLE\ORADATA\CITYBILL\CB2001.DBF' SIZE 256M 
AUTOEXTEND ON 
NEXT 128M
MAXSIZE  4096M
EXTENT MANAGEMENT LOCAL SEGMENT SPACE MANAGEMENT  AUTO
ONLINE;

CREATE TABLESPACE "CB2002" LOGGING 
DATAFILE 'D:\ORACLE\ORADATA\CITYBILL\CB2002.DBF' SIZE 256M 
AUTOEXTEND ON 
NEXT 128M
MAXSIZE  4096M
EXTENT MANAGEMENT LOCAL SEGMENT SPACE MANAGEMENT  AUTO
ONLINE;

CREATE TABLESPACE "CB2003" LOGGING 
DATAFILE 'D:\ORACLE\ORADATA\CITYBILL\CB2003.DBF' SIZE 256M 
AUTOEXTEND ON 
NEXT 128M
MAXSIZE  4096M
EXTENT MANAGEMENT LOCAL SEGMENT SPACE MANAGEMENT  AUTO
ONLINE;

CREATE TABLESPACE "CB2004" LOGGING 
DATAFILE 'D:\ORACLE\ORADATA\CITYBILL\CB2004.DBF' SIZE 256M 
AUTOEXTEND ON 
NEXT 128M
MAXSIZE  4096M
EXTENT MANAGEMENT LOCAL SEGMENT SPACE MANAGEMENT  AUTO
ONLINE;

CREATE TABLESPACE "CB2005" LOGGING 
DATAFILE 'D:\ORACLE\ORADATA\CITYBILL\CB2005.DBF' SIZE 256M 
AUTOEXTEND ON 
NEXT 128M
MAXSIZE  4096M
EXTENT MANAGEMENT LOCAL SEGMENT SPACE MANAGEMENT  AUTO
ONLINE;

CREATE TABLESPACE "CB2006" LOGGING 
DATAFILE 'D:\ORACLE\ORADATA\CITYBILL\CB2006.DBF' SIZE 256M 
AUTOEXTEND ON 
NEXT 128M
MAXSIZE  4096M
EXTENT MANAGEMENT LOCAL SEGMENT SPACE MANAGEMENT  AUTO
ONLINE;

CREATE TABLESPACE "CB2007" LOGGING 
DATAFILE 'D:\ORACLE\ORADATA\CITYBILL\CB2007.DBF' SIZE 256M 
AUTOEXTEND ON 
NEXT 128M
MAXSIZE  4096M
EXTENT MANAGEMENT LOCAL SEGMENT SPACE MANAGEMENT  AUTO
ONLINE;

CREATE TABLE cb.call (
  file_id number(11) NOT NULL,
  caller varchar(18) default NULL,
  peer varchar(25) default NULL,
  calltime date default NULL,
  duration number(6) default NULL,
  trunk_in varchar(6) default NULL,
  trunk_out varchar(6) default NULL
)
PARTITION BY RANGE (calltime)
(
PARTITION P200101 VALUES LESS THAN (TO_DATE('2001-02-01','YYYY-MM-DD')) TABLESPACE cb2001,
PARTITION P200102 VALUES LESS THAN (TO_DATE('2001-03-01','YYYY-MM-DD')) TABLESPACE cb2001,
PARTITION P200103 VALUES LESS THAN (TO_DATE('2001-04-01','YYYY-MM-DD')) TABLESPACE cb2001,
PARTITION P200104 VALUES LESS THAN (TO_DATE('2001-05-01','YYYY-MM-DD')) TABLESPACE cb2001,
PARTITION P200105 VALUES LESS THAN (TO_DATE('2001-06-01','YYYY-MM-DD')) TABLESPACE cb2001,
PARTITION P200106 VALUES LESS THAN (TO_DATE('2001-07-01','YYYY-MM-DD')) TABLESPACE cb2001,
PARTITION P200107 VALUES LESS THAN (TO_DATE('2001-08-01','YYYY-MM-DD')) TABLESPACE cb2001,
PARTITION P200108 VALUES LESS THAN (TO_DATE('2001-09-01','YYYY-MM-DD')) TABLESPACE cb2001,
PARTITION P200109 VALUES LESS THAN (TO_DATE('2001-10-01','YYYY-MM-DD')) TABLESPACE cb2001,
PARTITION P200110 VALUES LESS THAN (TO_DATE('2001-11-01','YYYY-MM-DD')) TABLESPACE cb2001,
PARTITION P200111 VALUES LESS THAN (TO_DATE('2001-12-01','YYYY-MM-DD')) TABLESPACE cb2001,
PARTITION P200112 VALUES LESS THAN (TO_DATE('2002-01-01','YYYY-MM-DD')) TABLESPACE cb2001,

PARTITION P200201 VALUES LESS THAN (TO_DATE('2002-02-01','YYYY-MM-DD')) TABLESPACE cb2002,
PARTITION P200202 VALUES LESS THAN (TO_DATE('2002-03-01','YYYY-MM-DD')) TABLESPACE cb2002,
PARTITION P200203 VALUES LESS THAN (TO_DATE('2002-04-01','YYYY-MM-DD')) TABLESPACE cb2002,
PARTITION P200204 VALUES LESS THAN (TO_DATE('2002-05-01','YYYY-MM-DD')) TABLESPACE cb2002,
PARTITION P200205 VALUES LESS THAN (TO_DATE('2002-06-01','YYYY-MM-DD')) TABLESPACE cb2002,
PARTITION P200206 VALUES LESS THAN (TO_DATE('2002-07-01','YYYY-MM-DD')) TABLESPACE cb2002,
PARTITION P200207 VALUES LESS THAN (TO_DATE('2002-08-01','YYYY-MM-DD')) TABLESPACE cb2002,
PARTITION P200208 VALUES LESS THAN (TO_DATE('2002-09-01','YYYY-MM-DD')) TABLESPACE cb2002,
PARTITION P200209 VALUES LESS THAN (TO_DATE('2002-10-01','YYYY-MM-DD')) TABLESPACE cb2002,
PARTITION P200210 VALUES LESS THAN (TO_DATE('2002-11-01','YYYY-MM-DD')) TABLESPACE cb2002,
PARTITION P200211 VALUES LESS THAN (TO_DATE('2002-12-01','YYYY-MM-DD')) TABLESPACE cb2002,
PARTITION P200212 VALUES LESS THAN (TO_DATE('2003-01-01','YYYY-MM-DD')) TABLESPACE cb2002,

PARTITION P200301 VALUES LESS THAN (TO_DATE('2003-02-01','YYYY-MM-DD')) TABLESPACE cb2003,
PARTITION P200302 VALUES LESS THAN (TO_DATE('2003-03-01','YYYY-MM-DD')) TABLESPACE cb2003,
PARTITION P200303 VALUES LESS THAN (TO_DATE('2003-04-01','YYYY-MM-DD')) TABLESPACE cb2003,
PARTITION P200304 VALUES LESS THAN (TO_DATE('2003-05-01','YYYY-MM-DD')) TABLESPACE cb2003,
PARTITION P200305 VALUES LESS THAN (TO_DATE('2003-06-01','YYYY-MM-DD')) TABLESPACE cb2003,
PARTITION P200306 VALUES LESS THAN (TO_DATE('2003-07-01','YYYY-MM-DD')) TABLESPACE cb2003,
PARTITION P200307 VALUES LESS THAN (TO_DATE('2003-08-01','YYYY-MM-DD')) TABLESPACE cb2003,
PARTITION P200308 VALUES LESS THAN (TO_DATE('2003-09-01','YYYY-MM-DD')) TABLESPACE cb2003,
PARTITION P200309 VALUES LESS THAN (TO_DATE('2003-10-01','YYYY-MM-DD')) TABLESPACE cb2003,
PARTITION P200310 VALUES LESS THAN (TO_DATE('2003-11-01','YYYY-MM-DD')) TABLESPACE cb2003,
PARTITION P200311 VALUES LESS THAN (TO_DATE('2003-12-01','YYYY-MM-DD')) TABLESPACE cb2003,
PARTITION P200312 VALUES LESS THAN (TO_DATE('2004-01-01','YYYY-MM-DD')) TABLESPACE cb2003,

PARTITION P200401 VALUES LESS THAN (TO_DATE('2004-02-01','YYYY-MM-DD')) TABLESPACE cb2004,
PARTITION P200402 VALUES LESS THAN (TO_DATE('2004-03-01','YYYY-MM-DD')) TABLESPACE cb2004,
PARTITION P200403 VALUES LESS THAN (TO_DATE('2004-04-01','YYYY-MM-DD')) TABLESPACE cb2004,
PARTITION P200404 VALUES LESS THAN (TO_DATE('2004-05-01','YYYY-MM-DD')) TABLESPACE cb2004,
PARTITION P200405 VALUES LESS THAN (TO_DATE('2004-06-01','YYYY-MM-DD')) TABLESPACE cb2004,
PARTITION P200406 VALUES LESS THAN (TO_DATE('2004-07-01','YYYY-MM-DD')) TABLESPACE cb2004,
PARTITION P200407 VALUES LESS THAN (TO_DATE('2004-08-01','YYYY-MM-DD')) TABLESPACE cb2004,
PARTITION P200408 VALUES LESS THAN (TO_DATE('2004-09-01','YYYY-MM-DD')) TABLESPACE cb2004,
PARTITION P200409 VALUES LESS THAN (TO_DATE('2004-10-01','YYYY-MM-DD')) TABLESPACE cb2004,
PARTITION P200410 VALUES LESS THAN (TO_DATE('2004-11-01','YYYY-MM-DD')) TABLESPACE cb2004,
PARTITION P200411 VALUES LESS THAN (TO_DATE('2004-12-01','YYYY-MM-DD')) TABLESPACE cb2004,
PARTITION P200412 VALUES LESS THAN (TO_DATE('2005-01-01','YYYY-MM-DD')) TABLESPACE cb2004,

PARTITION P200501 VALUES LESS THAN (TO_DATE('2005-02-01','YYYY-MM-DD')) TABLESPACE cb2005,
PARTITION P200502 VALUES LESS THAN (TO_DATE('2005-03-01','YYYY-MM-DD')) TABLESPACE cb2005,
PARTITION P200503 VALUES LESS THAN (TO_DATE('2005-04-01','YYYY-MM-DD')) TABLESPACE cb2005,
PARTITION P200504 VALUES LESS THAN (TO_DATE('2005-05-01','YYYY-MM-DD')) TABLESPACE cb2005,
PARTITION P200505 VALUES LESS THAN (TO_DATE('2005-06-01','YYYY-MM-DD')) TABLESPACE cb2005,
PARTITION P200506 VALUES LESS THAN (TO_DATE('2005-07-01','YYYY-MM-DD')) TABLESPACE cb2005,
PARTITION P200507 VALUES LESS THAN (TO_DATE('2005-08-01','YYYY-MM-DD')) TABLESPACE cb2005,
PARTITION P200508 VALUES LESS THAN (TO_DATE('2005-09-01','YYYY-MM-DD')) TABLESPACE cb2005,
PARTITION P200509 VALUES LESS THAN (TO_DATE('2005-10-01','YYYY-MM-DD')) TABLESPACE cb2005,
PARTITION P200510 VALUES LESS THAN (TO_DATE('2005-11-01','YYYY-MM-DD')) TABLESPACE cb2005,
PARTITION P200511 VALUES LESS THAN (TO_DATE('2005-12-01','YYYY-MM-DD')) TABLESPACE cb2005,
PARTITION P200512 VALUES LESS THAN (TO_DATE('2006-01-01','YYYY-MM-DD')) TABLESPACE cb2005,

PARTITION P200601 VALUES LESS THAN (TO_DATE('2006-02-01','YYYY-MM-DD')) TABLESPACE cb2006,
PARTITION P200602 VALUES LESS THAN (TO_DATE('2006-03-01','YYYY-MM-DD')) TABLESPACE cb2006,
PARTITION P200603 VALUES LESS THAN (TO_DATE('2006-04-01','YYYY-MM-DD')) TABLESPACE cb2006,
PARTITION P200604 VALUES LESS THAN (TO_DATE('2006-05-01','YYYY-MM-DD')) TABLESPACE cb2006,
PARTITION P200605 VALUES LESS THAN (TO_DATE('2006-06-01','YYYY-MM-DD')) TABLESPACE cb2006,
PARTITION P200606 VALUES LESS THAN (TO_DATE('2006-07-01','YYYY-MM-DD')) TABLESPACE cb2006,
PARTITION P200607 VALUES LESS THAN (TO_DATE('2006-08-01','YYYY-MM-DD')) TABLESPACE cb2006,
PARTITION P200608 VALUES LESS THAN (TO_DATE('2006-09-01','YYYY-MM-DD')) TABLESPACE cb2006,
PARTITION P200609 VALUES LESS THAN (TO_DATE('2006-10-01','YYYY-MM-DD')) TABLESPACE cb2006,
PARTITION P200610 VALUES LESS THAN (TO_DATE('2006-11-01','YYYY-MM-DD')) TABLESPACE cb2006,
PARTITION P200611 VALUES LESS THAN (TO_DATE('2006-12-01','YYYY-MM-DD')) TABLESPACE cb2006,
PARTITION P200612 VALUES LESS THAN (TO_DATE('2007-01-01','YYYY-MM-DD')) TABLESPACE cb2006,

PARTITION P200701 VALUES LESS THAN (TO_DATE('2007-02-01','YYYY-MM-DD')) TABLESPACE cb2007,
PARTITION P200702 VALUES LESS THAN (TO_DATE('2007-03-01','YYYY-MM-DD')) TABLESPACE cb2007,
PARTITION P200703 VALUES LESS THAN (TO_DATE('2007-04-01','YYYY-MM-DD')) TABLESPACE cb2007,
PARTITION P200704 VALUES LESS THAN (TO_DATE('2007-05-01','YYYY-MM-DD')) TABLESPACE cb2007,
PARTITION P200705 VALUES LESS THAN (TO_DATE('2007-06-01','YYYY-MM-DD')) TABLESPACE cb2007,
PARTITION P200706 VALUES LESS THAN (TO_DATE('2007-07-01','YYYY-MM-DD')) TABLESPACE cb2007,
PARTITION P200707 VALUES LESS THAN (TO_DATE('2007-08-01','YYYY-MM-DD')) TABLESPACE cb2007,
PARTITION P200708 VALUES LESS THAN (TO_DATE('2007-09-01','YYYY-MM-DD')) TABLESPACE cb2007,
PARTITION P200709 VALUES LESS THAN (TO_DATE('2007-10-01','YYYY-MM-DD')) TABLESPACE cb2007,
PARTITION P200710 VALUES LESS THAN (TO_DATE('2007-11-01','YYYY-MM-DD')) TABLESPACE cb2007,
PARTITION P200711 VALUES LESS THAN (TO_DATE('2007-12-01','YYYY-MM-DD')) TABLESPACE cb2007,
PARTITION P200712 VALUES LESS THAN (TO_DATE('2008-01-01','YYYY-MM-DD')) TABLESPACE cb2007
);

create table CB.FILES
(
  ID       NUMBER(6) not null,
  NAME     VARCHAR(50) not null,
  FILETIME DATE not null,
  FILESIZE NUMBER(9) not null,
  TIME     DATE not null,
  ATS      VARCHAR(6),
  md5      varchar(32),
  primary key (ID),
  unique (filesize,md5)
)  tablespace cbfiles;
 
create sequence CB.FILES_SQ
minvalue 1
maxvalue 99999999999
start with 1
increment by 1
cache 20;

Create Trigger cb.files_trg_insert Before Insert On cb.files
Referencing Old As Old New As New For Each Row
Begin
  If Nvl(:New.Id, 0) = 0 Then
    Select files_sq.Nextval Into :New.Id From Dual;
  End If;
End;
 
create index CALLER_IDX on CALL (CALLER) local;
create index CALLTIME_IDX on CALL (CALLTIME) local;
create index PEER_IDX on CALL (PEER) local;
